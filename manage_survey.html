<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Surveys</title>
<link rel="stylesheet" href="manage_survey.css">
</head>
<body>

<nav class="navbar">
    <div class="logo">Survey Management System</div>
    <ul class="nav-links">
        <li><a href="home_page.html">Home</a></li>
        <li><a href="dashboard_admin.html">Dashboard</a></li>
        <li><a class="active" href="manage_survey.html">Manage Surveys</a></li>
        <li><a href="login.html" class="logout-btn">Logout</a></li>
    </ul>
</nav>

<h1>Manage Surveys</h1>

<div class="survey-list" id="surveyList">
    <p>Loading surveys...</p>
</div>

<script>
document.addEventListener("DOMContentLoaded", loadSurveys);

function loadSurveys() {
    fetch("get_surveys.php")
        .then(res => res.json())
        .then(data => displaySurveys(data))
        .catch(() => {
            document.getElementById("surveyList").innerHTML = "<p>Error loading surveys.</p>";
        });
}

function displaySurveys(surveys) {
    const container = document.getElementById("surveyList");
    container.innerHTML = "";

    if (!surveys || surveys.length === 0) {
        container.innerHTML = "<p>No surveys found.</p>";
        return;
    }

    surveys.forEach(survey => {
        const div = document.createElement("div");
        div.className = "survey-item";

        let questionHtml = "";
        if (survey.questions && survey.questions.length > 0) {
            survey.questions.forEach((q, i) => {
                questionHtml += `
                    <div class="question-box-display">
                        <b>Q${i + 1} (${q.type}):</b> ${q.question}
                        <div class="question-actions">
                           
                        </div>
                `;

                if (q.type === "multiple" && q.options) {
                    questionHtml += "<ul class='options-list-display'>";
                    q.options.forEach(opt => {
                        questionHtml += `<li>${opt}</li>`;
                    });
                    questionHtml += "</ul>";
                }

                questionHtml += "</div>";
            });
        }

        div.innerHTML = `
            <h3>${survey.title}</h3>
            ${questionHtml}
            <button class="edit" onclick="editSurvey(${survey.id})">Edit Entire Survey</button>
            <button class="delete" onclick="deleteSurvey(${survey.id})">Delete Survey</button>
        `;
        container.appendChild(div);
    });
}


function editSurvey(id) {
    window.location.href = "create_survey.html?id=" + id;
}


function editQuestion(surveyId, questionId) {
 
    window.location.href = `create_survey.html?id=${surveyId}&editQuestion=${questionId}`;
}


function deleteQuestion(questionId, surveyId) {
    if (!confirm("Are you sure you want to delete this question?")) return;

    fetch(`delete_question.php?id=${questionId}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            loadSurveys();
        })
        .catch(() => alert("Failed to delete question."));
}


function deleteSurvey(id) {
    if (!confirm("Are you sure you want to delete this survey?")) return;

    fetch(`delete_survey.php?id=${id}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            loadSurveys();
        })
        .catch(() => alert("Failed to delete survey."));
}


</script>
</body>
</html>
